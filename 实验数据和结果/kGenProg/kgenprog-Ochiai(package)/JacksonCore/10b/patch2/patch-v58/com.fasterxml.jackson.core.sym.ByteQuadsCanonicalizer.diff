--- com.fasterxml.jackson.core.sym.ByteQuadsCanonicalizer
+++ com.fasterxml.jackson.core.sym.ByteQuadsCanonicalizer
@@ -770,6 +770,12 @@
         _hashArea[offset] = q1;
         _hashArea[offset+3] = 1;
         _names[offset >> 2] = name;
+		{
+			if (_failOnDoS) {
+				_reportTooManyCollisions();
+			}
+			_needRehash = true;
+		}
         ++_count;
         _verifyNeedForRehash();
         return name;
@@ -1040,7 +1046,6 @@
 
         for (int i = 3; i < qlen; ++i) {
             int next = q[i];
-            next = next ^ (next >> 21);
             hash += next;
         }
         hash *= MULT2;
